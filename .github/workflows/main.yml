# .github/workflows/main.yml

name: Hysteria Proxy Updater

on:
  schedule:
    - cron: '0 */4 * * *'  # Ø§Ø¬Ø±Ø§ Ù‡Ø± Û² Ø³Ø§Ø¹Øª ÛŒÚ©â€ŒØ¨Ø§Ø±
  workflow_dispatch:        # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Ù…Ø¬ÙˆØ² Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…ÛŒØª Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬

    steps:
      - name: Checkout repo content
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Download Hysteria client
        run: |
          LATEST_URL="https://github.com/apernet/hysteria/releases/latest/download/hysteria-linux-amd64"
          wget -O hysteria-linux-amd64 $LATEST_URL
          chmod +x hysteria-linux-amd64
          echo "âœ… Hysteria client downloaded."

      - name: 1. Fetch Hysteria Proxies
        run: python scripts/01_fetch_hysteria.py

      - name: 2. Test Hysteria Proxies (Real Connection)
        run: python scripts/02_test_hysteria.py

      - name: 3. Generate Final Output Files
        run: python scripts/03_generate_outputs.py
        
      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ðŸš€ Chore: Update Hysteria proxies"
          file_pattern: output/*.txt output/*.json
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions Bot <actions@github.com>"
